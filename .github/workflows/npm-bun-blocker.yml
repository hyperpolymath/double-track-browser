name: NPM/Bun Blocker
on: [push, pull_request]
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Block npm/bun
        run: |
          VIOLATIONS=""
          [ -f "package.json" ] && VIOLATIONS="$VIOLATIONS package.json"
          [ -f "package-lock.json" ] && VIOLATIONS="$VIOLATIONS package-lock.json"
          [ -f "bun.lockb" ] && VIOLATIONS="$VIOLATIONS bun.lockb"
          [ -f ".npmrc" ] && VIOLATIONS="$VIOLATIONS .npmrc"
          [ -f "yarn.lock" ] && VIOLATIONS="$VIOLATIONS yarn.lock"
          [ -f "pnpm-lock.yaml" ] && VIOLATIONS="$VIOLATIONS pnpm-lock.yaml"
          [ -d "node_modules" ] && VIOLATIONS="$VIOLATIONS node_modules/"

          if [ -n "$VIOLATIONS" ]; then
            echo "❌ npm/bun/pnpm/yarn artifacts detected. Use Deno instead."
            echo "Violations:$VIOLATIONS"
            exit 1
          fi
          echo "✅ No npm/bun violations - Deno policy enforced"
